---
title: JS中的正则
date: 2016-10-4 19:46:46
tags: [javascript]
---
撸了些关于正则的东西，写篇总结。轻喷。
参考《精通正则表达式》，mdn文档，《高程》。

## 元字符
JS中的元字符众多，大致可以分为下面几类。
匹配一个字符：./[...]/[^...]；
匹配位置：^/$；
提供计数功能：*/+/?/{n}/{min,max}；
转译：\char；
括号：()/(?:...)；
<!--more-->
环视：(?=...)/(?!...)；
或：|。
具体功能见下表

字符      |	含义	  
----------|-----------
.         |匹配任意字符，JS中的.不会匹配换行符
[...]     |字符组，匹配...
[^...]    |排除字符组，匹配不包含...的
^         |输入的开始
$         |输入的结束
*         |匹配任意次
+         |匹配一次或多次
?	        |匹配0次或一次  
{n}       |匹配n次
{min,max} |匹配至少min次，最多max次
\         |转义
()        |限定多选结构范围，标注量词作用的元素，捕获文本
(?:...)   |非捕获括号，不会进行捕获，也就是说不会记录在\1，$1这种东西里
(?=...)   |顺序环视，右面是...
(?!...)   |否定顺序环视，右面不是...|

关于环视，就是右边有或者没有。下面是一个简单的小例子。
```js
var re = /John(?=s)/
var str = 'Johns candy'
str.replace(re,"John'") // "John's candy"
```
转义字符的含义

字符      |	含义	  
----------|-----------
\b        |单词边界
\B        |非单词边界
\d        |数字
\D        |非数字
\f        |换页
\n        |换行
\r        |回车
\s	      |任一空白字符
\S        |非空白字符
\t        |水平制表符 tab
\v        |垂直制表符（这玩意在JS里是啥）
\w        |数字字母下划线
\W        |非数字字母下划线
\1、\2... |\后面接整数表示反向引用，匹配之前括号内表达式匹配的文本|

说一下\1这种，表示与第1个括号匹配内容。下面是一个简单的小例子。
```js
var re = /(\*)\1/g
var str = 'c**x*y'
str.replace(re,'*') // "c*x*y"
```
## RegExp类型
有两种方式创建正则对象：字面量和构造函数。
re = / pattern / flags
patten是正则表达式。flags是标志，标明正则的行为
g：全局模式，找到所有的匹配项；
i：不区分大小写；
m：多行模式，到本行末尾还会继续查找。
```js
var re = /\s/g
var re = new RegExp('\s','g')
var re = new RegExp(/\s/,'g')
// 三种等价
```
### RegExp的属性
- $1,$2...获取引用项
```js
var re = /(\w+)/
var str = 'sss,ttt'
str.match(re)
RegExp.$1 // "sss"
```
- lastMatch 最后匹配到的字符串
- input $_ 匹配到的源字符串
还有lastParen、leftContex、rightContext这些，不多做介绍了，不然这个博文就变成文档。### 原型属性
- gloabal,ignoreCase,multiline分别表示是否设置g,i,m
- source,flags分别返回表达式文本字符串和标志
- lastIndex 下一次匹配开始位置

### 方法
这里的方法都是原型上的方法了。
- exec() 匹配一个字符串
如果匹配成功，匹配的字符串作为第一个元素，后面的每个元素对应一个成功匹配被捕获的字符串。如果没有匹配成功的则返回null。
当使用g标志时，需要多次调用exec()来匹配下一项，直到最终返回值为Null。也就是说，当使用g标志时，每一次匹配都会更新RegExp对象的lastIndex，下一次调用将从lastIndex位置开始往下查找。

- test() 检查是否有匹配
返回true或false表示是否匹配。
使用g标志时，这个方法也会更新lastIndex。

## 字符串相关方法
- search() 字符串与一个正则表达式是否匹配
如果匹配返回首次匹配的索引，否则返回-1.

- match() 匹配正则表达式
如果没有g，返回结果与RegExp.exec()一样，即如果匹配成功，匹配的字符串作为第一个元素，后面的每个元素对应一个成功匹配被捕获的字符串。
如果有g，返回匹配到的所有字符串组成的数组。
如果没有匹配成功的则返回null。

- replace() 替换
replace方法的第一个参数可以是正则表达式。
在第二个参数中，可以使用$1,$2...来表示第1个，第2个...捕获到的匹配项。
```js
var re = /(John)/
var str = 'John candy'
str.replace(re,"$1's")  // "John's candy"
```
字符串去除连续重复字母的例子。
```js
var re = /(\w)\1+/g
var str = 'aaaaaaaabccccffgggg'
str.replace(re, '$1') // "abcfg"
```

- split() 分割成数组
这个方法的第一个参数也可以是正则。
如果这个正则包含捕获括号，则匹配的结果也会成为数组的一个元素。
```js
var re = /\*/
var str = 'c*x*y'
str.split(re) // ["c", "x", "y"]

var re = /(\*)/
var str = 'c*x*y'
str.split(re) // ["c", "*", "x", "*", "y"]
```